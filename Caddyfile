# Mission Control Caddy Configuration
{
    # Disable admin API for security
    admin off
    
    # Don't persist config to disk
    persist_config off
    
    # Disable automatic HTTPS (Railway handles TLS termination)
    auto_https off
    
    # JSON structured logging for better monitoring
    log {
        format json
    }
    
    # Trust Railway's proxy network
    servers {
        trusted_proxies static private_ranges 100.0.0.0/8
    }
}

# Bind to Railway's assigned port (defaults to 3000 locally)
:{$PORT:3000} {
    # Enable JSON logging for this site
    log {
        format json
    }
    
    # Health check endpoint for Railway monitoring
    # Rewrite /health requests to serve any file (proves server is running)
    rewrite /health /*
    
    # Serve files from the dist directory
    root * dist
    
    # Enable gzip compression for better performance
    encode gzip
    
    # Enable static file serving
    file_server
    
    # SPA routing: try to serve the requested file, fall back to index.html
    # This ensures React Router works correctly for all routes
    try_files {path} /index.html
    
    # Security headers for Mission Control app
    header {
        # Prevent MIME type sniffing
        X-Content-Type-Options nosniff
        
        # Enable XSS protection
        X-XSS-Protection "1; mode=block"
        
        # Control framing (allow same origin for potential embeds)
        X-Frame-Options SAMEORIGIN
        
        # Cache static assets for better performance
        Cache-Control "public, max-age=31536000" {
            path_regexp \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$
        }
        
        # Don't cache HTML files (for deployments)
        Cache-Control "no-cache, no-store, must-revalidate" {
            path *.html
        }
    }
}